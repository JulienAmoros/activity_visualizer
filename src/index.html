<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Activity Visualizer</title>
</head>
<body>
    <div class="container">
        <header>
            <h1>üìÖ Activity Visualizer</h1>
            <p class="subtitle">Import and visualize your activities from multiple sources</p>
        </header>

        <div class="content">
            <div id="status" class="status-message"></div>

            <div class="upload-section">
                <h2>Import Activities</h2>
                <div class="file-input-group">
                    <div class="file-input-wrapper">
                        <input type="file" id="csvFile" accept=".csv">
                        <label for="csvFile" class="file-label">üìä Import CSV</label>
                    </div>
                    <button id="trelloImportBtn" class="import-btn">üîó Trello import</button>
                    <div class="file-input-wrapper">
                        <input type="file" id="icalFile" accept=".ics,.ical">
                        <label for="icalFile" class="file-label">üìÜ Import Calendar</label>
                    </div>
                    <div class="file-input-wrapper">
                        <input type="file" id="mboxFile" accept=".mbox">
                        <label for="mboxFile" class="file-label" id="mboxFileLabel" title="Enter your mail below first">üìß Import Mails</label>
                    </div>
                    <div class="file-import-wrapper">
                        <input type="file" id="jsonFile" accept=".json">
                        <label for="jsonFile" class="file-label">Import JSON ‚¨ÜÔ∏è</label>
                    </div>
                    <button id="clearBtn" class="clear-btn">üóëÔ∏è Clear All</button>
                </div>

                <details class="collapsable-section" id="mboxImportOptions">
                    <summary>MBOX import options</summary>
                    <input type="text" id="emailInput" placeholder="john.doe@company.com" class="email-input">
                    <label for="emailInput" class="file-label" id="emailInputLabel">Enter email for MBOX filtering</label>
                </details>

                <details class="collapsable-section" id="trelloImportOptions">
                    <summary>Trello credentials</summary>

                    <label for="trelloApiKey" class="trello-creds-label" id="trelloApiKeyLabel">Enter your Trello API Key</label>
                    <input type="text" id="trelloApiKey" placeholder="Your Trello API Key" class="trello-api-key-input">
                    <label for="trelloAuthToken" class="trello-creds-label" id="trelloAuthTokenLabel">Enter your Trello Authentication Token</label>
                    <input type="text" id="trelloAuthToken" placeholder="Your Trello Authentication Token" class="trello-api-key-input">
                    <label for="trelloUsername" class="trello-creds-label" id="trelloUsernameLabel">Enter your Trello Username</label>
                    <input type="text" id="trelloUsername" placeholder="Your Trello Username" class="trello-api-key-input">
                </details>

                <details class="collapsable-section">
                    <summary>Instructions & How to</summary>

                    <details class="collapsable-section">
                    <summary>CSV import</summary>
                        For test purposes, or custom import, you probably ain't going to need this.<br>
                        <br>
                        CSV format: [title(string), start(ISODateString), endStr(ISODateString), description(string), location(string)]
                    </details>

                    <details class="collapsable-section">
                    <summary>Trello import</summary>
                        This option allows you to import your Trello activities directly into the visualizer.<br>
                        <br>
                        1. Get your trello API credentials<br>
                        - Go to <a href="https://trello.com/power-ups/admin">Trello Power-ups page</a> to get your API Key and generate and Authentication Token.<br>
                        - Click on "new" <br>
                        <br>
                        <image src="./assets/trello/step1.png" height="300px" width="700px"><br>
                        <br>
                        - Create a new power-ups, fill the form like below and click "Create"<br>
                        <br>
                        <image src="./assets/trello/step2.png" height="500px" width="900px"><br>
                        <br>
                        - Click on "Generate a new API Key"<br>
                        <br>
                        <image src="./assets/trello/step3.png" height="300px" width="700px"><br>
                        <br>
                        - Copy the API key<br>
                        <br>
                        <image src="./assets/trello/step4.png" height="300px" width="700px"><br>
                        <br>
                        - Paste the key in the following link (replace "{YourAPIKey}" with the API key): <code>https://trello.com/1/authorize?expiration=1day&scope=read&response_type=token&key={YourAPIKey}</code></code><br>
                        <br>
                        - Access this link and click on "Authorize"<br>
                        <br>
                        <image src="./assets/trello/step5.png"><br>
                        <br>
                        - Copy the Authentication Token, it will be valid for only one day<br>
                        - ‚ö†Ô∏è DO NOT SHARE this Authentication Token with anyone ‚ö†Ô∏è<br>
                        <br>
                        <image src="./assets/trello/step6.png"><br>
                        <br>
                        - Copy the API key and Authentication token (see screenshot below)<br>
                        - Put your trello username<br>
                        - Finally, click on the button "Trello Import"<br>
                        <br>
                        <image src="./assets/trello/step7.png" height="400px" width="700px"><br>

                        ‚ö†Ô∏è As of now, only 1000 last comments are fetched, you may miss some older activities.
                    </details>

                    <details class="collapsable-section">
                    <summary>iCal import</summary>
                        This option allows you to import any calendar activities (iCal format) into the visualizer.<br>
                        <br>
                        Example with Google Calendar:<br>
                        1. Go to <a href="https://calendar.google.com/calendar/u/0/r/settings/export">Google Calendar settings</a> (Settings > Import and Export).<br>
                        2. Click on Export, it downloads a ZIP file.<br>
                        3. Unzip the downloaded file to get the .ics files for each of your calendars (the file you want should be named "`your_email_address`.ics").<br>
                        4. Use the "Import Calendar" button to select and import the .ics file into the visualizer.<br>

                        Note: Only events from the last 3 years are imported to keep the data relevant.
                    </details>

                    <details class="collapsable-section">
                    <summary>MBOX import</summary>
                        This option allows you to import your email activities from an MBOX file into the visualizer.<br>
                        <br>
                        Example with Gmail:<br>
                        1. Go to <a href="https://takeout.google.com/settings/takeout">Google Takeout</a>.<br>
                        2. Deselect all, then scroll down and select "Mail".<br>
                        3. Click on "All data are included" button, a popup opens, uncheck "Include all messages" and select only "Sent"<br>
                        4. Scroll to the end of the page and click on "Next step", then "Create export".<br>
                        5. Once the export is ready, download the ZIP file and extract it.<br>
                        6. Inside the extracted folder, locate the "Sent.mbox" file.<br>
                        7. Put your email address in the MBOX import options field to keep only emails sent by you.<br>
                        8. Use the "Import Mails" button to select and import the .mbox file into the visualizer.<br>

                        Note: Only emails from the last 3 years are imported to keep the data relevant.
                    </details>

                    <details class="collapsable-section">
                    <summary>JSON import / Export</summary>
                        This option allows you to export your current activities and hours worked data as a JSON file for backup or further analysis.<br>
                        <br>
                        To export your data, simply click on the "Export JSON" button in the "Global Hours Tracker" section.<br>
                        <br>
                        To import previously exported data, use the "Import JSON" button in the "Import Activities" section and select your JSON file.<br>
                        <br>
                        ‚ö†Ô∏è Exported file contains your activities and hours worked data, therefore <b>it may contain personal and confidential data.</b><br>
                        ‚ö†Ô∏è Note that importing a JSON file will replace all current data in the visualizer with the data from the file.<br>
                    </details>

                    <details class="collapsable-section">
                    <summary>How to use this?</summary>
                        1. Import your activities using the provided import options (CSV, Trello, iCal, MBOX).<br>
                        2. Navigate through the activity timeline using the date selector.<br>
                        3. Once you selected some date, set the number of hours worked or mark days off as needed (this sets the number of hours to a default value). You can enter hours on dates with no Activity.<br>
                        4. Track your global hours worked in the dedicated section.<br>
                        5. Export your data as JSON for backup or further analysis.<br>

                        ‚ö†Ô∏è <b>Data is not stored locally</b>, make sure to export your data (you can use the JSON export button below) before closing the app! ‚ö†Ô∏è

                        ProTip: Once you've imported some data, you can click on the day in hours tracker to quickly navigate to that date in the timeline.
                    </details>
                </details>
            </div>

            <div class="timeline-section">

                <h2>Activity Timeline</h2>
                <div class="date-selector">
                    <button id="dayBefore" class="button">‚¨ÖÔ∏è</button>
                    <p id="currentDate" class="date-label"></p>
                    <button id="dayAfter" class="button">‚û°Ô∏è</button>
                    <label for="dateInput">Select Date:</label>
                    <input type="date" id="dateInput">
                    <label for="hoursInput">Hours Worked:</label>
                    <input type="number" id="hoursInput" min="0" max="24" step="0.5" placeholder="0">
                    <button id="setHoursBtn" class="set-hours-btn">Set Hours</button>
                    <button id="setDayOffBtn" class="set-hours-btn">Set as Day OFF</button>
                </div>
                <div id="visualization"></div>
            </div>

            <div class="daily-hours-section">
                <h2>Global Hours Tracker</h2>

                <button id="exportBtn" class="export-btn">Export JSON ‚¨áÔ∏è</button>
                <a id="downloadAnchorElem" style="display:none"></a>

                <div class="hours-display">
                    <h3>Hours Worked by Date</h3>
                    <div id="yearsList"></div>
                </div>
            </div>
        </div>
    </div>
</body>
</html>
